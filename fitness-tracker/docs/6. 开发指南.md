# 开发指南

本文档为Fitness Tracker项目的开发提供了指导和规范。

## 项目结构

```
fitness-tracker/
├── backend/           # 后端API
│   ├── src/
│   │   ├── config/       # 配置文件
│   │   ├── controllers/  # 控制器
│   │   ├── middleware/   # 中间件
│   │   ├── models/       # 数据模型
│   │   ├── routes/       # 路由
│   │   └── server.ts     # 应用入口
│   ├── .env              # 环境变量配置
│   ├── Dockerfile        # 生产环境Docker配置
│   ├── Dockerfile.dev    # 开发环境Docker配置
│   └── package.json      # 后端依赖配置
├── frontend/          # 前端应用
│   ├── src/
│   │   ├── components/   # 公共组件
│   │   ├── pages/        # 页面组件
│   │   ├── services/     # API服务
│   │   ├── App.tsx       # 根组件
│   │   └── main.tsx      # 前端入口
│   ├── Dockerfile        # 生产环境Docker配置
│   ├── Dockerfile.dev    # 开发环境Docker配置
│   └── package.json      # 前端依赖配置
├── deployments/       # 部署配置
│   ├── docker-compose.yml      # 生产环境编排配置
│   ├── docker-compose.dev.yml  # 开发环境编排配置
│   └── docker-compose.cn.yml   # 中国特供编排配置
├── tests/             # 测试文件
│   ├── api-test.js           # API测试
│   ├── full-api-test.js      # 完整API测试
│   ├── simple-test.js        # 简单测试
│   └── test-api.js           # API测试
├── docs/              # 文档
│   ├── 1. 项目介绍.md
│   ├── 2. 快速开始.md
│   ├── 3. 部署指南.md
│   ├── 4. API接口文档.md
│   ├── 5. 数据库设计.md
│   └── 6. 开发指南.md
├── mysql/             # MySQL初始化脚本
│   └── init.sql       # 数据库初始化脚本
└── README.md          # 项目主说明文件
```

## 技术栈

### 前端
- React + TypeScript
- TailwindCSS (响应式设计)
- React Router (路由管理)
- Axios (HTTP客户端)

### 后端
- Node.js + Express
- TypeScript
- MySQL + Sequelize (数据库)
- JWT (身份验证)
- Bcryptjs (密码加密)

## 开发环境搭建

### 前端开发环境
1. 安装依赖:
   ```bash
   cd frontend
   npm install
   ```

2. 启动开发服务器:
   ```bash
   npm run dev
   ```

3. 访问应用: http://localhost:3000

### 后端开发环境
1. 安装依赖:
   ```bash
   cd backend
   npm install
   ```

2. 配置环境变量:
   复制 `.env.example` 为 `.env` 并填写相应配置

3. 启动开发服务器:
   ```bash
   npm run dev
   ```

4. API服务: http://localhost:3001

## 添加新功能

### 后端开发流程

1. **创建数据模型**
   - 在 `backend/src/models/` 目录下创建新的数据模型文件
   - 使用Sequelize定义模型结构和验证规则

2. **创建控制器**
   - 在 `backend/src/controllers/` 目录下创建控制器文件
   - 实现业务逻辑处理

3. **添加API路由**
   - 在 `backend/src/routes/` 目录下创建路由文件
   - 定义RESTful API端点

4. **更新路由注册**
   - 在 `backend/src/server.ts` 中注册新的路由

### 前端开发流程

1. **创建页面组件**
   - 在 `frontend/src/pages/` 目录下创建新的页面组件
   - 实现页面UI和交互逻辑

2. **创建公共组件**
   - 在 `frontend/src/components/` 目录下创建可复用的公共组件

3. **更新路由配置**
   - 在 `frontend/src/App.tsx` 中添加新的路由

4. **更新API服务**
   - 在 `frontend/src/services/api.ts` 中添加相应的API调用方法

## 代码规范

### TypeScript规范
- 使用TypeScript进行类型检查
- 为所有函数和变量定义明确的类型
- 使用接口定义对象结构

### React规范
- 遵循React Hooks最佳实践
- 组件职责单一，保持组件简洁
- 合理使用useState、useEffect等Hook

### CSS规范
- 使用TailwindCSS工具类进行样式设计
- 遵循响应式设计原则
- 保持样式一致性

### 后端规范
- 使用async/await处理异步操作
- 合理使用中间件处理通用逻辑
- 实现统一的错误处理机制

## 数据库操作

### 模型定义
使用Sequelize定义数据模型，示例：
```typescript
import { DataTypes, Model } from 'sequelize';
import { sequelize } from '../config/db';

class User extends Model {
  public id!: number;
  public name!: string;
  public email!: string;
  public password!: string;
}

User.init({
  id: {
    type: DataTypes.INTEGER.UNSIGNED,
    autoIncrement: true,
    primaryKey: true,
  },
  name: {
    type: DataTypes.STRING(100),
    allowNull: false,
  },
  email: {
    type: DataTypes.STRING(100),
    allowNull: false,
    unique: true,
  },
  password: {
    type: DataTypes.STRING(255),
    allowNull: false,
  },
}, {
  tableName: 'users',
  sequelize,
});

export default User;
```

### 数据操作
使用Sequelize提供的方法进行数据操作：
```typescript
// 创建记录
const user = await User.create({ name, email, password });

// 查询记录
const user = await User.findByPk(userId);

// 更新记录
await user.update({ name, email });

// 删除记录
await user.destroy();
```

## API设计规范

### RESTful原则
- 使用HTTP动词表示操作类型(GET、POST、PUT、DELETE)
- 使用名词表示资源
- 保持URL简洁明了

### 响应格式
```json
{
  "success": true,
  "data": {},
  "message": "操作成功"
}
```

### 错误处理
```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "错误描述"
  }
}
```

## 测试

### 单元测试
- 为每个独立功能编写单元测试
- 使用Jest作为测试框架

### API测试
- 编写API接口测试确保功能正常
- 使用Supertest进行HTTP请求测试

### 运行测试
```bash
# 运行后端测试
cd backend
npm run test

# 运行前端测试
cd frontend
npm run test
```

## Docker化开发

### 构建镜像
```bash
# 构建前端镜像
docker build -t fitness-tracker-frontend ./frontend

# 构建后端镜像
docker build -t fitness-tracker-backend ./backend
```

### 启动容器
```bash
# 启动开发环境
docker-compose -f deployments/docker-compose.dev.yml up -d

# 启动生产环境
docker-compose -f deployments/docker-compose.yml up -d
```

## 部署

### 生产环境构建
```bash
# 构建前端
cd frontend
npm run build

# 构译后端
cd backend
npm run build
```

### 部署到服务器
1. 复制构建产物到服务器
2. 配置环境变量
3. 启动服务

## 常见问题解决

### 1. 依赖安装问题
- 清除npm缓存: `npm cache clean --force`
- 删除node_modules和package-lock.json重新安装

### 2. 数据库连接问题
- 检查环境变量配置
- 确认数据库服务是否启动
- 验证数据库用户权限

### 3. API调用失败
- 检查后端服务是否运行
- 验证API端点是否正确
- 查看浏览器控制台错误信息

### 4. Docker构建失败
- 检查Dockerfile路径
- 确认基础镜像是否可用
- 查看构建日志定位问题